---
import { getCollection } from 'astro:content';
import BaseLayout from '@/layouts/BaseLayout.astro';
import Header from '@/components/Header.astro';
import Footer from '@/components/Footer.astro';
import profile from '@/content/profile.json';
import { personLd, websiteLd, siteMeta } from '@/utils/seo';

const projects = (await getCollection('projects'))
  .sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime())
  .slice(0, 3);

const projectLd = projects.map((project) => ({
  '@context': 'https://schema.org',
  '@type': 'CreativeWork',
  name: project.data.title,
  description: project.data.summary,
  dateCreated: project.data.date,
  url: `${siteMeta.siteUrl}/projects/${project.slug}`
}));
---

<BaseLayout>
  <Header />
  <main>
    <section class="section">
      <div class="container-base">
        <p class="fade-up text-sm uppercase tracking-[0.2em] text-neutral-500">Portfolio</p>
        <h1 class="fade-up mt-4 text-5xl font-semibold leading-tight md:text-7xl">{profile.name}</h1>
        <p class="fade-up-delay mt-4 text-lg text-neutral-700 md:text-xl">{profile.affiliation}</p>
        <p class="fade-up-delay mt-8 max-w-3xl text-lg leading-relaxed text-neutral-700">{profile.intro}</p>
        <div class="fade-up-delay mt-10 flex flex-wrap gap-4">
          <a href="/projects" class="rounded-md bg-neutral-900 px-6 py-3 text-sm font-medium text-white transition hover:bg-neutral-700">Projects</a>
          <a href="#contact" class="rounded-md border border-neutral-300 px-6 py-3 text-sm font-medium text-neutral-900 transition hover:border-neutral-900">Contact</a>
        </div>
      </div>
    </section>

    <section class="section border-t border-neutral-200">
      <div class="container-base">
        <h2 class="text-3xl font-semibold md:text-4xl">About</h2>
        <p class="mt-6 max-w-3xl leading-relaxed text-neutral-700">{profile.about}</p>
        <div class="mt-10 grid gap-8 md:grid-cols-2">
          <article>
            <h3 class="text-lg font-medium">研究・興味領域</h3>
            <ul class="mt-4 space-y-2 text-neutral-700">
              {profile.interests.map((item) => <li>• {item}</li>)}
            </ul>
          </article>
          <article>
            <h3 class="text-lg font-medium">強み</h3>
            <ul class="mt-4 space-y-2 text-neutral-700">
              {profile.strengths.map((item) => <li>• {item}</li>)}
            </ul>
          </article>
        </div>
      </div>
    </section>

    <section class="section border-t border-neutral-200">
      <div class="container-base">
        <div class="flex items-end justify-between gap-4">
          <h2 class="text-3xl font-semibold md:text-4xl">Projects</h2>
          <a href="/projects" class="text-sm text-accent hover:underline">すべて見る</a>
        </div>
        <div class="mt-10 grid gap-6 md:grid-cols-2 xl:grid-cols-3">
          {projects.map((project) => (
            <article class="rounded-xl border border-neutral-200 p-6">
              <p class="text-xs text-neutral-500">{project.data.date}</p>
              <h3 class="mt-3 text-xl font-medium">{project.data.title}</h3>
              <p class="mt-3 leading-relaxed text-neutral-700">{project.data.summary}</p>
              <div class="mt-4 flex flex-wrap gap-2">
                {project.data.tags.map((tag) => <span class="rounded bg-neutral-100 px-2.5 py-1 text-xs text-neutral-700">{tag}</span>)}
              </div>
              <a href={`/projects/${project.slug}`} class="mt-6 inline-block text-sm text-accent hover:underline">詳細を見る</a>
            </article>
          ))}
        </div>
      </div>
    </section>

    <section class="section border-t border-neutral-200">
      <div class="container-base">
        <h2 class="text-3xl font-semibold md:text-4xl">Skills</h2>
        <div class="mt-10 grid gap-8 md:grid-cols-3">
          {Object.entries(profile.skills).map(([category, values]) => (
            <div>
              <h3 class="text-lg font-medium">{category}</h3>
              <div class="mt-4 flex flex-wrap gap-2">
                {values.map((skill) => <span class="rounded-md border border-neutral-200 px-3 py-1.5 text-sm">{skill}</span>)}
              </div>
            </div>
          ))}
        </div>
      </div>
    </section>

    <section class="section border-t border-neutral-200">
      <div class="container-base">
        <h2 class="text-3xl font-semibold md:text-4xl">Experience / Education</h2>
        <ol class="mt-10 space-y-8 border-l border-neutral-200 pl-6">
          {profile.timeline.map((item) => (
            <li class="relative">
              <span class="absolute -left-[30px] top-2 h-2 w-2 rounded-full bg-accent"></span>
              <p class="text-sm text-neutral-500">{item.period}</p>
              <h3 class="mt-1 text-xl font-medium">{item.title}</h3>
              <p class="mt-2 leading-relaxed text-neutral-700">{item.description}</p>
            </li>
          ))}
        </ol>
      </div>
    </section>

    <section id="contact" class="section border-t border-neutral-200">
      <div class="container-base">
        <h2 class="text-3xl font-semibold md:text-4xl">Contact</h2>
        <p class="mt-6 max-w-2xl leading-relaxed text-neutral-700">研究・開発のご相談や共同プロジェクトのご連絡は、メールでお気軽にご連絡ください。</p>
        <a class="mt-8 inline-block rounded-md bg-accent px-6 py-3 text-sm font-medium text-white hover:bg-blue-500" href={`mailto:${profile.contact.email}`} aria-label="メールを送信">{profile.contact.email}</a>
      </div>
    </section>
  </main>
  <Footer />

  <script type="application/ld+json" set:html={JSON.stringify(personLd)}></script>
  <script type="application/ld+json" set:html={JSON.stringify(websiteLd)}></script>
  <script type="application/ld+json" set:html={JSON.stringify(projectLd)}></script>
</BaseLayout>
